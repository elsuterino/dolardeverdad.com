<template>
    <div>
        <nav class="bg-gray-800 p-2 flex items-center justify-center">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                version="1.1"
                class="w-12 h-12 fill-current text-yellow-500 mr-2"
                viewBox="0 0 179.006 179.006"
                fill
            >
                <path
                    d="M124.759,52.664c0-1.462-0.543-2.572-1.617-3.33c-0.621-0.448-1.665-0.865-3.121-1.265v9.219    c1.999-0.09,3.377-0.823,4.135-2.19C124.562,54.406,124.759,53.582,124.759,52.664z"
                />
                <path
                    d="M118.362,36.213c-1.551,0.06-2.637,0.525-3.3,1.402c-0.662,0.877-0.985,1.796-0.985,2.751    c0,1.158,0.382,2.059,1.152,2.721c0.782,0.65,1.82,1.11,3.121,1.366L118.362,36.213L118.362,36.213z"
                />
                <path
                    d="M119.174,67.42c11.128,0,20.162-9.022,20.162-20.15s-9.034-20.156-20.162-20.156    s-20.15,9.028-20.15,20.156C99.023,58.404,108.039,67.42,119.174,67.42z M112.753,45.247c-1.211-1.122-1.826-2.679-1.826-4.666    c0-1.778,0.644-3.377,1.951-4.803c1.307-1.426,3.121-2.154,5.484-2.172v-2.333h1.659v2.297c2.333,0.161,4.111,0.847,5.358,2.053    c1.235,1.211,1.886,2.798,1.945,4.785h-3.067c-0.084-0.889-0.328-1.653-0.722-2.297c-0.734-1.181-1.909-1.802-3.532-1.856v8.539    c2.715,0.758,4.559,1.474,5.537,2.136c1.575,1.098,2.363,2.727,2.363,4.875c0,3.109-1.014,5.316-3.037,6.629    c-1.122,0.728-2.739,1.205-4.851,1.438v3.401h-1.659v-3.401c-3.395-0.221-5.71-1.426-6.928-3.61    c-0.662-1.175-0.996-2.775-0.996-4.785h3.109c0.101,1.599,0.352,2.769,0.758,3.509c0.722,1.319,2.088,2.059,4.069,2.226v-9.553    C115.82,47.174,113.953,46.369,112.753,45.247z"
                />
                <path
                    d="M84.655,19.16c0-1.092-0.406-1.927-1.211-2.5c-0.465-0.334-1.247-0.644-2.345-0.949v6.916    c1.492-0.066,2.542-0.615,3.109-1.641C84.5,20.466,84.655,19.858,84.655,19.16z"
                />
                <path
                    d="M79.852,6.832c-1.164,0.048-1.981,0.394-2.476,1.056c-0.489,0.656-0.74,1.349-0.74,2.065    c0,0.871,0.292,1.545,0.871,2.041c0.579,0.489,1.36,0.835,2.345,1.026L79.852,6.832L79.852,6.832z"
                />
                <path
                    d="M80.455,30.234c8.342,0,15.114-6.772,15.114-15.12S88.796,0,80.455,0S65.34,6.766,65.34,15.114    C65.34,23.468,72.113,30.234,80.455,30.234z M75.639,13.598c-0.913-0.841-1.366-2.005-1.366-3.497    c0-1.331,0.489-2.536,1.468-3.604c0.979-1.068,2.351-1.617,4.105-1.629V3.121h1.247v1.724c1.742,0.125,3.085,0.632,4.028,1.539    c0.925,0.907,1.414,2.1,1.456,3.586h-2.303c-0.066-0.662-0.239-1.241-0.537-1.724c-0.567-0.883-1.438-1.349-2.643-1.39v6.402    c2.035,0.567,3.407,1.104,4.141,1.605c1.175,0.823,1.772,2.041,1.772,3.658c0,2.333-0.758,3.986-2.273,4.97    c-0.841,0.543-2.053,0.901-3.64,1.08v2.554h-1.247v-2.554c-2.554-0.167-4.29-1.068-5.191-2.709    c-0.501-0.883-0.758-2.082-0.758-3.592h2.345c0.066,1.199,0.257,2.076,0.561,2.631c0.549,0.991,1.569,1.545,3.055,1.671v-7.166    C77.948,15.042,76.54,14.44,75.639,13.598z"
                />
                <path
                    d="M70.114,86.412c-3.341-0.579-5.734-2.005-7.071-4.392c-0.871-1.522-1.295-3.586-1.295-6.188h4.01    c0.125,2.071,0.465,3.58,0.991,4.535c0.937,1.712,2.685,2.667,5.245,2.882V70.892c-3.276-0.621-5.698-1.653-7.262-3.103    c-1.569-1.456-2.351-3.467-2.351-6.033c0-2.297,0.847-4.362,2.524-6.212c1.689-1.838,4.046-2.775,7.089-2.81v-3.013h2.154v2.971    c3.007,0.215,5.316,1.098,6.916,2.655c1.617,1.563,2.458,3.622,2.536,6.182h-3.962c-0.113-1.146-0.418-2.136-0.931-2.971    c-0.955-1.522-2.47-2.327-4.559-2.399v11.039c3.509,0.985,5.877,1.909,7.136,2.763c2.047,1.42,3.061,3.52,3.061,6.301    c0,4.022-1.307,6.874-3.914,8.568c-1.08,0.692-2.619,1.152-4.415,1.498c5.221,0.179,10.418,1.02,15.43,2.53    c4.732-4.726,7.667-11.248,7.667-18.461c0-14.392-11.677-26.057-26.057-26.057c-14.386,0-26.057,11.665-26.057,26.057    c0,7.435,3.121,14.124,8.121,18.867C59.976,87.683,65.024,86.734,70.114,86.412z"
                />
                <path
                    d="M67.978,65.009c0.991,0.847,2.345,1.438,4.034,1.772V56.124c-1.993,0.078-3.419,0.68-4.266,1.814    c-0.853,1.134-1.271,2.321-1.271,3.562C66.474,62.992,66.975,64.156,67.978,65.009z"
                />
                <path
                    d="M78.193,73.076c-0.806-0.573-2.142-1.116-4.04-1.629v11.922c2.584-0.125,4.362-1.068,5.346-2.834    c0.519-0.907,0.776-1.963,0.776-3.151C80.276,75.487,79.583,74.061,78.193,73.076z"
                />
                <path
                    d="M162.398,138.849c3.18-3.324,3.473-9.475,2.954-17.704c-3.741-0.257-9.261,0.37-11.212,0    c-4.738-9.428-11.546-16.779-21.242-21.248c0.328-6.152,1.152-11.808,4.708-14.75c-8.646-0.597-15.979,5.257-20.639,10.621    c-4.195-4.35-10.394-7.817-17.704-10.257l-4.541,8.079c-13.515-4.66-28.343-4.606-41.774,0.137l-5.925-7.96    c-0.012-0.024-0.036-0.048-0.054-0.066c-9.267,3.067-17.781,7.87-24.416,14.786c-4.314-0.328-3.825-9.076,1.772-7.667    c-9.105-6.206-14.13,10.806-5.316,12.978c-7.345,10.496-8.049,33.027,1.772,41.297c1.432,12.423,3.628,24.088,9.672,31.911h19.822    c-0.519-4.034-1.044-8.33-0.591-13.032c12.047,2.733,26.35,3.532,40.7,2.363c2.214,3.67,4.356,7.411,7.005,10.663h19.637    c-0.71-5.197-1.504-10.639-0.084-15.979C121.668,162.132,145.971,155.956,162.398,138.849z M135.308,112.505    c2.697,0,4.875,2.184,4.875,4.869c0,2.703-2.178,4.881-4.875,4.881c-2.685,0-4.875-2.19-4.875-4.881    C130.427,114.695,132.623,112.505,135.308,112.505z"
                />
            </svg>
            <h1 class="uppercase text-white font-bold text-xl">dólar de verdad</h1>
        </nav>

        <section class="px-2 py-10">
            <div class="container mx-auto">
                <!-- head -->
                <div class="flex justify-between items-end mb-4">
                    <div class="text-white text-3xl font-bold">
                        <div class="hidden md:block">
                            {{ chart.source.name }}
                            <small class="text-gray-500">{{ chart.source.id }}</small>
                        </div>
                    </div>
                    <div>
<!--                        <button-->
<!--                            class="text-yellow-500 border-yellow-500 border rounded py-1 px-3 flex items-center hover:bg-yellow-500 hover:text-gray-900"-->
<!--                        >-->
<!--                        <span class="mr-2">-->
<!--                            <svg-->
<!--                                aria-hidden="true"-->
<!--                                focusable="false"-->
<!--                                data-prefix="fas"-->
<!--                                data-icon="share-alt"-->
<!--                                class="w-4 h-4"-->
<!--                                role="img"-->
<!--                                xmlns="http://www.w3.org/2000/svg"-->
<!--                                viewBox="0 0 448 512"-->
<!--                            >-->
<!--                                <path-->
<!--                                    fill="currentColor"-->
<!--                                    d="M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96-42.981-96-96-96z"-->
<!--                                />-->
<!--                            </svg>-->
<!--                        </span>-->
<!--                            Compatir something-->
<!--                        </button>-->
                    </div>
                </div>

                <!-- main shit -->
                <div class="flex md:flex-row flex-col -mx-3">
                    <div class="md:w-1/3 md:order-2">
                        <div class="bg-gray-800 p-6 mx-3 mb-6 rounded">
                            <ul>
                                <li class="font-semibold text-lg">Todas las cotizaciones</li>
                                <li v-for="rate in rates" class="flex items-center py-3 text-sm border-b last:border-b-0 border-gray-700">
                                    <div class="flex-1 flex-no-grow flex-no-shrink">
                                        <div class="font-semibold">{{ rate.source.name }}</div>
                                        <div class="text-gray-500">{{ rate.source.id }}</div>
                                    </div>
                                    <div class="text-right">
                                        <div>
                                            {{ formatMoney(rate.value, rate.target.id) }}
                                        </div>
                                        <div :class="[rate.gross > 0 ? 'text-green-400' : 'text-red-400']">
                                            {{ rate.gross | formatPercent }}%
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="md:w-2/3">
                        <div class="bg-gray-800 p-6 mx-3 mb-6 rounded">
                            <div class="flex justify-between mb-4">
                                <div class="flex-1">
                                    <div class="uppercase text-gray-500">cotizacion</div>
                                    <div class="font-bold text-2xl md:text-3xl">
                                        {{ formatMoney(latest) }}
                                        <span v-if="!latest" class="opacity-0">Bs.S</span>
                                    </div>
                                    <transition name="fade" mode="out-in" tag="div">
                                        <div v-if="!loading.chartData"
                                             :class="[gross > 0 ? 'text-green-500' : 'text-red-500']">
                                            {{ chart.source.id }} ({{ gross | formatPercent }}%)
                                        </div>
                                        <div v-else class="opacity-0">%</div>
                                    </transition>
                                </div>
                                <div class="">
                                    <div class="flex flex-1 text-gray-500 justify-end mb-2">
                                                                                <button
                                            class="p-2 outline-none focus:outline-none hidden md:inline-block"
                                            type="button"
                                            :class="{'text-yellow-500': period === 'day'}"
                                            @click="setPeriod('day')">
                                            24H
                                        </button>
                                        <button
                                            class="p-2 outline-none focus:outline-none hidden md:inline-block"
                                            type="button"
                                            :class="{'text-yellow-500': period === 'week'}"
                                            @click="setPeriod('week')">
                                            1S
                                        </button>
                                        <button
                                            class="p-2 outline-none focus:outline-none hidden md:inline-block"
                                            type="button"
                                            :class="{'text-yellow-500': period === 'month'}"
                                            @click="setPeriod('month')">
                                            1M
                                        </button>
                                        <button
                                            class="p-2 outline-none focus:outline-none hidden md:inline-block"
                                            type="button"
                                            :class="{'text-yellow-500': period === 'year'}"
                                            @click="setPeriod('year')">
                                            1A
                                        </button>
                                        <!--                    <button-->
                                        <!--                        class="p-2 outline-none focus:outline-none"-->
                                        <!--                        type="button"-->
                                        <!--                        :class="{'text-yellow-500': period === 'all'}"-->
                                        <!--                        @click="setPeriod('all')">-->
                                        <!--                        ALL-->
                                        <!--                    </button>-->
                                    </div>
                                    <div class="text-gray-500 font-mono flex flex-col items-end">
                                        <select class="px-3 py-1 bg-gray-700 rounded-lg outline-none focus:outline-none md:hidden mb-2"
                                                v-model="period">
                                            <option value="day">24H</option>
                                            <option value="week">1S</option>
                                            <option value="month">1M</option>
                                            <option value="year">1A</option>
                                        </select>

                                        <select class="px-3 py-1 bg-gray-700 rounded-lg outline-none focus:outline-none"
                                                v-model="currency">
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                            <option value="CLP">CLP</option>
                                            <option value="COP">COP</option>
                                            <option value="ARS">ARS</option>
                                            <option value="PEN">PEN</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="-mx-6 relative">
                                <transition name="fade">
                                    <div v-if="this.loading.chartData" class="absolute top-0" style="right: 1.5rem;">
                                        <div
                                            class="w-6 h-6 border-2 rounded-full spin duration-500 border-gray-700"
                                            style="border-top-color: #ecc94b;"/>
                                    </div>
                                </transition>
                                <chart
                                    :chart-data="chartData"
                                ></chart>
                            </div>

                            <div class="h-5 flex items-end justify-end">
                                <div v-if="chartData.length" class="text-right text-xs text-gray-400">
                                    <span class="text-gray-600">Desde</span>
                                    <span>{{ new Date(chartData[0].time).toLocaleDateString('es-VE') }}</span>
                                    <span class="text-gray-600">hasta</span>
                                    <span>{{ new Date(chartData[chartData.length - 1].time).toLocaleDateString('es-VE') }}</span>
                                </div>
                            </div>
<!--                                <ul v-if="chartData.length"-->
<!--                                    class="flex items-center justify-between uppercase text-gray-500 text-sm">-->
<!--                                    <li>{{ new Date(chartData[0].time).toLocaleString() }}</li>-->
<!--                                    <li>{{ new Date(chartData[chartData.length - 1].time).toLocaleString() }}</li>-->
<!--                                </ul>-->
                        </div>
                        <div class="bg-gray-800 p-6 mx-3 mb-6 rounded text-gray-400">
                            <h3 class="font-bold text-xl mb-4 text-white">
                                ¿De dónde se obtiene el precio?
                            </h3>
                            <p class="mb-4">
                                De la simple oferta y demanda, es decir, de las transacciones
                                reales completadas del sitio
                                <a
                                    class="text-yellow-500 hover:underline"
                                    href="https://localbitcoins.com/es/?ch=ykb7"
                                >localbitcoins.com</a
                                >
                            </p>
                            <p class="mb-4">
                                Durante las últimas 24 horas se han completado transacciones de
                                compra y venta por un costo total de:
                            </p>
                            <p class="mb-4">74,795,535,716 Bolivares</p>
                            <p>782,204 Dolares</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</template>

<script>
    import axios from "../plugins/axios";
    import Chart from "./Chart";

    export default {
        props: {
            rates: Array
        },
        components: {
            Chart
        },
        data() {
            return {
                currency: 'USD',
                chartData: [],
                gross: 0,
                latest: 0,
                period: 'day',
                loading: {
                    chartData: true
                },
                ready: {
                    chartData: false
                },
                chart: {
                    source: {
                        id: "USD",
                        name: "US Dollar",
                        name_es: "Dólar estadounidense",
                    }
                }
            }
        },
        watch: {
            currency() {
                this.updateChartData();
            },
            period(){
                this.updateChartData();
            }
        },
        computed: {},
        created() {
            this.updateChartData();
        },
        methods: {
            setPeriod(interval) {
                this.period = interval;
            },
            updateChartData() {
                this.loading.chartData = true;
                axios
                    .get('/api/chart', {
                        params: {
                            period: this.period,
                            target_id: 'VES',
                            source_id: this.currency
                        }
                    })
                    .then(response => {
                        this.chartData = response.data.chart;
                        this.gross = response.data.gross
                        this.latest = response.data.latest;
                        this.chart.source = response.data.source;
                    })
                    .finally(() => {
                        this.loading.chartData = false;
                        this.ready.chartData = true;
                    });
            }
        }
    }
</script>
<style>
    .fade-enter-active, .fade-leave-active {
        transition: opacity .5s;
    }

    .fade-enter, .fade-leave-to /* .fade-leave-active below version 2.1.8 */
    {
        opacity: 0;
    }

    .spin {
        animation: spin;
        animation-duration: 1s;
        animation-iteration-count: infinite;
    }

    @keyframes spin {
        from {
            transform: rotate(0);
        }
        to {
            transform: rotate(360deg);
        }
    }
</style>
